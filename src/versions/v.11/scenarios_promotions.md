# Promotions and Discounts System — Test Scenarios (README)

## C. ระบบโปรโมชั่นและส่วนลด (Promotions and Discounts)

**เป้าหมาย:** วัดความถูกต้องของตรรกะทางธุรกิจที่ซับซ้อน (Business Logic Execution) และลำดับการคำนวณ

---

## ตาราง 8: Acceptance Scenarios สำหรับระบบโปรโมชั่น (กรณีการทำงานปกติ)

| กรณีทดสอบ (Scenario) | เงื่อนไขเริ่มต้น (Given) | การกระทำ (When) | ผลลัพธ์ที่คาดหวัง (Expected Result / Then) |
|---|---|---|---|
| 1) การตรวจสอบสิทธิ์คูปอง (Coupon Validation) | ตะกร้ามีราคารวม **1,000 บาท** คูปอง **"SAVE100"**<br>เงื่อนไข: ซื้อขั้นต่ำ **500 บาท** | ผู้ใช้กรอกรหัส **"SAVE100"** และกดใช้งาน | 1) ระบบตรวจสอบเงื่อนไขขั้นต่ำผ่าน (**1,000 >= 500**)<br>2) ราคารวมลดลง **100 บาท** (เหลือ **900 บาท**)<br>3) แสดงข้อความ **"ใช้คูปองสำเร็จ"** |
| 2) การคำนวณส่วนลดท้ายบิล (Cart Total Discount %) | ตะกร้ามีราคารวม **2,000 บาท** โปรโมชั่นลด **10%** ท้ายบิล | ระบบทำการคำนวณยอดรวมในหน้า Checkout | 1) คำนวณส่วนลดถูกต้อง: **2,000 x 10% = 200 บาท**<br>2) ราคาสุทธิ (Grand Total) ต้องเท่ากับ **1,800 บาท**<br>3) แสดงยอดส่วนลดแยกบรรทัดชัดเจน |
| 3) การกำหนดวันหมดอายุ (Expiration Date Check) | คูปอง **"EXPIRED"** วันหมดอายุคือ **เมื่อวาน** | ผู้ใช้พยายามกรอกรหัส **"EXPIRED"** ใน **วันนี้** | 1) ระบบต้องปฏิเสธการใช้งาน (Reject)<br>2) ราคารวมต้อง **ไม่เปลี่ยนแปลง**<br>3) แสดงข้อความแจ้งเตือน **"คูปองหมดอายุ"** |

---

## ตาราง 9: กรณีทดสอบขีดจำกัดและความผิดพลาด สำหรับระบบโปรโมชั่น (Edge Cases)

| กรณีทดสอบ (Edge Case) | สถานการณ์จำลอง (Context & Test) | ผลลัพธ์ที่ต้องทำได้ (Expected Result) | เกณฑ์การประเมิน (Evaluation Criteria) |
|---|---|---|---|
| 1) การใช้คูปองซ้ำเกินสิทธิ์ (Coupon Usage Limit) | **Context:** คูปอง **"WELCOME"** ใช้ได้ **1 ครั้ง/คน**<br>**Test:**<br>1) ผู้ใช้ใช้คูปองนี้ไปแล้วใน **Order #1**<br>2) ผู้ใช้พยายามนำกลับมาใช้ใหม่ใน **Order #2** | - ระบบต้องปฏิเสธ (Throw Error)<br>- แจ้งเตือนว่า **"คุณใช้สิทธิ์ครบแล้ว"**<br>- ห้ามลดราคาในออเดอร์ที่ 2 | ตรวจสอบว่าโค้ดมีการ Query ประวัติการใช้งาน (Usage History Lookup) ก่อนอนุมัติส่วนลดหรือไม่ |
| 2) ลำดับการคำนวณผิดพลาด (Order of Operations) | **Context:** มีสินค้า **1,000 บาท** มีส่วนลด 2 ตัว: ลด **10%** และ ลด **100 บาท**<br>**Test:** ใช้ส่วนลดทั้งสองพร้อมกัน | - ต้องคำนวณตามลำดับที่ถูกต้อง (ตามสเปก)<br>- ปกติควรเป็น: **(1,000 - 10%) - 100 = 800**<br>- ห้ามคำนวณผิด เช่น: **(1,000 - 100) - 10% = 810** | ตรวจสอบ Logic การเรียงลำดับ Math Operation ว่า AI เข้าใจ Business Rule หรือไม่ หรือแค่เอาตัวเลขมาลบกันมั่วๆ |
| 3) การป้องกันยอดติดลบ (Negative Total Protection) | **Context:** สินค้าราคา **50 บาท**<br>**Test:** ผู้ใช้ใช้คูปองส่วนลดมูลค่า **100 บาท** | - ราคารวมสุทธิต้องเป็น **0 บาท** (หรือปฏิเสธคูปอง)<br>- ห้ามยอดรวมติดลบ (**-50 บาท**) เด็ดขาด | ตรวจสอบการเขียน Logic ป้องกันค่าติดลบ เช่น `Math.max(0, total)` |
