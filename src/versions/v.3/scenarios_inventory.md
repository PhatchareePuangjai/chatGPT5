# Inventory Management System — Test Scenarios (README)

## A. ระบบจัดการสินค้าคงคลัง (Inventory Management)

**เป้าหมาย:** วัดความแม่นยำในการจัดการข้อมูล (Data Consistency) และการทำงานพร้อมกัน (Concurrency)

---

## ตาราง 4: Acceptance Scenarios (กรณีการทำงานปกติ)

| กรณีทดสอบ (Scenario) | เงื่อนไขเริ่มต้น (Given) | การกระทำ (When) | ผลลัพธ์ที่คาดหวัง (Expected Result / Then) |
|---|---|---|---|
| 1) การตัดสต็อกสำเร็จ (Successful Stock Deduction) | สินค้า **SKU-001** มีจำนวน **10 ชิ้น** | ผู้ใช้สั่งซื้อ **2 ชิ้น** และชำระเงินสำเร็จ | 1) จำนวนสินค้าในฐานข้อมูลลดเหลือ **8 ชิ้น** ทันที<br>2) สร้างบันทึกใน `InventoryLog` ประเภท **"SALE"** จำนวน **-2**<br>3) ระบบส่งคืนสถานะ **Success** |
| 2) การแจ้งเตือนสินค้าใกล้หมด (Low Stock Alert Trigger) | สินค้า **SKU-002** มีจำนวน **6 ชิ้น** (**Threshold = 5**) | ผู้ใช้สั่งซื้อ **2 ชิ้น** (เหลือจริง **4 ชิ้น**) | 1) จำนวนสินค้าลดเหลือ **4 ชิ้น**<br>2) ระบบตรวจสอบพบว่า **4 ≤ 5** จึงทำการสร้าง **Alert Record** หรือส่ง **Event** แจ้งเตือนผู้ดูแลระบบ |
| 3) การคืนสต็อกจากการยกเลิก (Stock Restoration) | สินค้า **SKU-003** มีจำนวน **5 ชิ้น** | คำสั่งซื้อ (จอง **1 ชิ้น**) ถูกยกเลิก หรือหมดเวลา (Expired) | 1) จำนวนสินค้าคืนกลับมาเป็น **6 ชิ้น**<br>2) สร้างบันทึกใน `InventoryLog` ประเภท **"RESTOCK/RETURN"** จำนวน **+1** |

---

## ตาราง 5: Edge Cases (กรณีทดสอบขีดจำกัดและความผิดพลาด)

| กรณีทดสอบ (Edge Case) | สถานการณ์จำลอง (Context & Test) | ผลลัพธ์ที่ต้องทำได้ (Expected Result) | เกณฑ์การประเมิน (Evaluation Criteria) |
|---|---|---|---|
| 1) การแย่งซื้อสินค้าชิ้นสุดท้าย (Race Condition) | **Context:** สินค้าเหลือ **1 ชิ้น** สุดท้าย<br>**Test:** ยิง Request สั่งซื้อพร้อมกัน **5 คำสั่ง** ในเวลาเสี้ยววินาที (Concurrent Requests) | - ต้องมีเพียง **1 คำสั่งซื้อ** ที่สำเร็จ<br>- อีก **4 คำสั่งซื้อ** ต้องได้รับ Error (**Insufficient Stock**)<br>- สต็อกคงเหลือต้องเป็น **0** (**ห้ามติดลบ**) | ตรวจสอบว่าโค้ดมีการใช้ **Database Locking** (เช่น `SELECT ... FOR UPDATE`) หรือ **Transaction** เพื่อจัดการลำดับข้อมูลหรือไม่ |
| 2) ความเป็นอะตอมของธุรกรรม (Transaction Atomicity) | **Context:** การตัดสต็อกต้องเกิดคู่กับการบันทึก Log เสมอ<br>**Test:** สั่งตัดสต็อกสำเร็จ แต่จำลองให้เกิด Error ตอนบันทึก `InventoryLog` (เช่น DB หลุด) | - ระบบต้อง **Rollback** ค่าสต็อกกลับมาเท่าเดิม (**All or Nothing**)<br>- ห้ามเกิดกรณี “ของถูกตัดไปแล้ว แต่ไม่มี Log บันทึก” | ตรวจสอบว่า SQL ทั้งหมดถูกห่อหุ้มอยู่ภายใต้ **Database Transaction Block เดียวกัน** หรือไม่ |
| 3) การซื้อเกินจำนวนที่มี (Overselling Attempt) | **Context:** สินค้าเหลือ **5 ชิ้น**<br>**Test:** ผู้ใช้คนเดียวสั่งซื้อ **6 ชิ้น** ในครั้งเดียว | - ระบบต้องปฏิเสธทันที (**Throw Error**)<br>- สต็อกต้องเหลือ **5** เท่าเดิม (**ห้ามตัดก่อนแล้วค่อยคืนทีหลัง**) | ตรวจสอบการเขียน **Validation Logic** ก่อนการบันทึกข้อมูล |
| 4) ค่าขอบเขตของ Low Stock (Boundary Value) | **Context:** แจ้งเตือนเมื่อต่ำกว่าหรือเท่ากับ **5 (≤ 5)**<br>**Test:** ทดสอบลดจำนวนเหลือ **6, 5, 4** | - เหลือ **6** → ไม่แจ้งเตือน<br>- เหลือ **5** → ต้องแจ้งเตือน<br>- เหลือ **4** → ต้องแจ้งเตือน | ตรวจสอบความแม่นยำของ **Comparison Operator** ว่าใช้ `<` หรือ `<=` ถูกต้องตามสเปกหรือไม่ |