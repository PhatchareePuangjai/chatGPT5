# üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢: ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏∏‡∏Å‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô

## üéØ ‡∏ö‡∏ó‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£ (Executive Summary)

‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏ô‡∏µ‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå e-commerce/inventory system ‡∏ó‡∏µ‡πà‡∏°‡∏µ 11 ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô (v.1 - v.11) ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ 3 ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:

1. **Code Review Analysis** - ‡∏Å‡∏≤‡∏£‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (Architecture, Patterns, Features)
2. **SonarQube Analysis** - ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (Security, Reliability, Maintainability, Duplications)
3. **Version Analysis** - ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ (Trends, Evolution, Comparisons)

**‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏´‡∏•‡∏±‡∏Å:**
- ‚úÖ ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÇ‡∏Ñ‡πâ‡∏î‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á: v.3 (3‚≠ê) ‚Üí v.11 (5‚≠ê)
- ‚úÖ v.11 ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏ó‡∏±‡πâ‡∏á 3 ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
- ‚ö†Ô∏è ‡∏û‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: Test Coverage = 0.0% ‡∏ó‡∏∏‡∏Å‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô
- ‚ö†Ô∏è v.4 ‡πÅ‡∏•‡∏∞ v.10 ‡∏°‡∏µ Code Duplications ‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å (65.5%, 34.8%)
- ‚ö†Ô∏è v.10 ‡∏°‡∏µ Security vulnerabilities ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (5 ‡∏à‡∏∏‡∏î)

**‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤ (Development Methods):**
- **v.3, v.4, v.5:** Basic Prompt (‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÅ‡∏ö‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô)
- **v.6, v.7, v.8:** Context Engineering (‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ context ‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô)
- **v.9, v.10, v.11:** SDD - Spec-Driven Development (‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡∏≤‡∏° specification)

---

## üìö ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á

- [Code Review Analysis](./CODE_REVIEW.md) - ‡∏Å‡∏≤‡∏£‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
- [SonarQube Analysis](./versions/sonarQube.md) - ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
- [Version Analysis Notebook](./version_analysis.ipynb) - ‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤

**‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** Code Evolution Analysis ‡∏ñ‡∏π‡∏Å‡∏£‡∏ß‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 8 ‡∏Ç‡∏≠‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß

---

## üìä 1. ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏±‡πâ‡∏á 3 ‡∏ß‡∏¥‡∏ò‡∏µ

### 1.1 Code Review Analysis

**‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£:** ‡∏Å‡∏≤‡∏£‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå Architecture, Patterns, Features, Best Practices

**‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å v.3):**

| Version | Quality Score | Key Features | Architecture | Development Method |
|---------|--------------|--------------|--------------|---------------------|
| v.3 | ‚≠ê‚≠ê‚≠ê‚òÜ‚òÜ (3/5) | Docker, Tests | Monolithic | Basic Prompt |
| v.4 | ‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ (4/5) | Zod, ES Modules, Row Locking | Service Layer | Basic Prompt |
| v.5 | ‚≠ê‚≠ê‚≠ê‚òÜ‚òÜ (3/5) | TypeScript (Frontend) | Monolithic | Basic Prompt |
| v.6 | ‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ (4/5) | Concurrency Safety | Service Layer | Context Engineering |
| v.7 | ‚≠ê‚≠ê‚≠ê‚òÜ‚òÜ (3/5) | Stock Guard | Basic | Context Engineering |
| v.8 | ‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ (4/5) | Error Middleware, Money Utils | Service Layer | Context Engineering |
| v.9 | ‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ (4/5) | API Endpoints, Alerts | Service Layer | SDD (Spec-Driven) |
| v.10 | ‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ (4/5) | Zod, ES Modules | Service Layer | SDD (Spec-Driven) |
| v.11 | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5/5) | Repository Pattern, Error Factory | Clean Architecture | SDD (Spec-Driven) |

**‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô:**
- v.4 ‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏∏‡∏î‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÄ‡∏û‡∏¥‡πà‡∏° Zod validation, ES Modules, Row Locking (Basic Prompt)
- v.6-v.8: ‡πÉ‡∏ä‡πâ Context Engineering - ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô (Concurrency Safety, Error Middleware)
- v.9-v.11: ‡πÉ‡∏ä‡πâ SDD (Spec-Driven Development) - ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (v.11: 5‚≠ê)

**‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á:**
- v.3: ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ Validation ‡πÅ‡∏•‡∏∞ Error Handling ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (Basic Prompt)
- v.5: Backend ‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ CommonJS (‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡πá‡∏ô ES Modules) (Basic Prompt)
- v.6: SonarQube ‡∏û‡∏ö Reliability ‡πÅ‡∏•‡∏∞ Maintainability issues ‡∏™‡∏π‡∏á (Context Engineering)

---

### 1.2 SonarQube Analysis

**‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£:** ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏î‡πâ‡∏ß‡∏¢ SonarQube (9,285 lines of code)

**‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏ß‡∏°:**

| Metric | Value | Status |
|--------|-------|--------|
| **Lines of Code** | 9,285 | - |
| **Security Vulnerabilities** | 6 | ‚ö†Ô∏è |
| **Reliability Issues** | 101 | ‚ö†Ô∏è |
| **Maintainability Issues** | 148 | ‚ö†Ô∏è |
| **Security Hotspots** | 44 | üîç |
| **Test Coverage** | 0.0% | ‚ùå |
| **Code Duplications** | 16.6% | ‚ö†Ô∏è |

**‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏≤‡∏¢‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å v.3):**

| Version | Security | Reliability | Maintainability | Duplications | Dev Method | Best Metric |
|---------|----------|-------------|-----------------|--------------|------------|-------------|
| v.3 | 0 ‚úÖ | 3 ‚úÖ | 7 ‚úÖ | 24.2% ‚ö†Ô∏è | Basic Prompt | Maintainability: 7 (‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î) |
| v.4 | 0 ‚úÖ | 9 ‚ö†Ô∏è | 18 ‚ö†Ô∏è | **65.5%** ‚ùå | Basic Prompt | - |
| v.5 | 0 ‚úÖ | **1** ‚úÖ | 10 ‚úÖ | **1.4%** ‚úÖ | Basic Prompt | Reliability: 1 (‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î) |
| v.6 | 0 ‚úÖ | 19 ‚ö†Ô∏è | **26** ‚ö†Ô∏è | 9.3% ‚úÖ | Context Engineering | - |
| v.7 | 0 ‚úÖ | 9 ‚ö†Ô∏è | 12 ‚ö†Ô∏è | 4.3% ‚úÖ | Context Engineering | - |
| v.8 | 0 ‚úÖ | 17 ‚ö†Ô∏è | 20 ‚ö†Ô∏è | **0.0%** ‚úÖ | Context Engineering | Duplications: 0.0% |
| v.9 | 1 ‚ö†Ô∏è | **22** ‚ùå | 18 ‚ö†Ô∏è | 3.1% ‚úÖ | SDD | - |
| v.10 | **5** ‚ùå | 9 ‚ö†Ô∏è | 12 ‚ö†Ô∏è | 34.8% ‚ùå | SDD | - |
| v.11 | 0 ‚úÖ | 8 ‚úÖ | 17 ‚ö†Ô∏è | **0.0%** ‚úÖ | SDD | Best Overall |

**‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô:**
- v.11: Security = 0, Duplications = 0.0%, Reliability = 8
- v.5: Reliability = 1 (‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î), Duplications = 1.4%
- v.8: Duplications = 0.0%
- v.3: Maintainability = 7 (‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)

**‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:**
- v.10: Security = 5 (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î), Duplications = 34.8%
- v.4: Duplications = 65.5% (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)
- v.9: Reliability = 22 (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î), Security = 1
- v.6: Maintainability = 26 (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î), Reliability = 19

---

### 1.3 Version Analysis (Notebook)

**‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£:** ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ (Pandas, Matplotlib, Seaborn)

**‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:**

**‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÇ‡∏Ñ‡πâ‡∏î:**
- Average Quality Score: 3.60‚≠ê (v.3-v.11)
- Quality Improvement: 2 stars (v.3: 3‚≠ê ‚Üí v.11: 5‚≠ê)
- Best Version: v.11 (5‚≠ê, 10 features)

**Features Evolution:**
- v.3: 3 features (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô)
- v.4: 9 features (‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î‡πÉ‡∏´‡∏ç‡πà - Basic Prompt)
- v.11: 10 features (‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î - SDD)

**Architecture Evolution:**
- v.3: Monolithic (Basic Prompt)
- v.4-v.10: Service Layer (Basic Prompt ‚Üí Context Engineering ‚Üí SDD)
- v.11: Repository + Service Pattern (Clean Architecture - SDD)

**Development Method Impact:**
- **Basic Prompt (v.3-v.5):** ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û 3-4‚≠ê, ‡∏°‡∏µ features ‡∏î‡∏µ ‡πÅ‡∏ï‡πà Code Duplications ‡∏™‡∏π‡∏á (v.4: 65.5%)
- **Context Engineering (v.6-v.8):** ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û 3-4‚≠ê, Code Duplications ‡∏•‡∏î‡∏•‡∏á (v.8: 0.0%)
- **SDD (v.9-v.11):** ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û 4-5‚≠ê, Architecture ‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô (v.11: Clean Architecture)

**Tech Stack Adoption:**
- ES Modules: v.4, v.10
- TypeScript: v.2, v.5 (Frontend only)
- Zod Validation: v.4, v.10, v.11
- Docker: v.3+ (‡∏ó‡∏∏‡∏Å‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô)
- Tests: v.3, v.4, v.5, v.6, v.8, v.10, v.11

---

## üîç 2. ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÇ‡∏Ñ‡πâ‡∏î

### 2.1 ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤ (Development Methods)

‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ 3 ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô:

#### üìù Basic Prompt (v.3, v.4, v.5)

**‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞:**
- ‡πÉ‡∏ä‡πâ prompt ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤
- ‡πÑ‡∏°‡πà‡∏°‡∏µ context ‡∏´‡∏£‡∏∑‡∏≠ specification ‡∏ó‡∏µ‡πà‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
- ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**
- ‚úÖ v.3: ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û 3‚≠ê, Maintainability ‡∏î‡∏µ (7 ‡∏à‡∏∏‡∏î)
- ‚úÖ v.4: ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û 4‚≠ê, ‡∏°‡∏µ features ‡∏î‡∏µ (Zod, ES Modules, Row Locking)
- ‚ö†Ô∏è v.4: Code Duplications ‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å (65.5%)
- ‚úÖ v.5: Reliability ‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (1 ‡∏à‡∏∏‡∏î), Code Duplications ‡∏ï‡πà‡∏≥ (1.4%)

**‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï:**
- ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏≤‡∏Å v.3 ‚Üí v.4 (3‚≠ê ‚Üí 4‚≠ê)
- ‡πÅ‡∏ï‡πà Code Duplications ‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å‡πÉ‡∏ô v.4 (65.5%)
- v.5 ‡∏°‡∏µ metrics ‡∏î‡∏µ‡∏°‡∏≤‡∏Å ‡πÅ‡∏ï‡πà Backend ‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ CommonJS

#### üß† Context Engineering (v.6, v.7, v.8)

**‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞:**
- ‡πÉ‡∏ä‡πâ context ‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤
- ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö requirements
- ‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö‡πÉ‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**
- ‚úÖ v.6: ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û 4‚≠ê, ‡∏°‡∏µ Concurrency Safety (FOR UPDATE)
- ‚ö†Ô∏è v.6: SonarQube ‡∏û‡∏ö Reliability (19) ‡πÅ‡∏•‡∏∞ Maintainability (26) ‡∏™‡∏π‡∏á
- ‚úÖ v.7: ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û 3‚≠ê, Code Duplications ‡∏ï‡πà‡∏≥ (4.3%)
- ‚úÖ v.8: Code Duplications = 0.0% (‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î), Error Middleware

**‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï:**
- Code Duplications ‡∏•‡∏î‡∏•‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô (v.4: 65.5% ‚Üí v.8: 0.0%)
- ‡πÅ‡∏ï‡πà SonarQube ‡∏û‡∏ö issues ‡∏™‡∏π‡∏á‡πÉ‡∏ô v.6 (Reliability: 19, Maintainability: 26)
- v.8 ‡∏°‡∏µ Code Duplications = 0.0% - ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏µ

#### üìã SDD - Spec-Driven Development (v.9, v.10, v.11)

**‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞:**
- ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡∏≤‡∏° specification ‡∏ó‡∏µ‡πà‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
- ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÅ‡∏•‡∏∞‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤
- ‡πÄ‡∏ô‡πâ‡∏ô Clean Architecture ‡πÅ‡∏•‡∏∞ Best Practices

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**
- ‚ö†Ô∏è v.9: ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û 4‚≠ê, ‡πÅ‡∏ï‡πà Reliability issues ‡∏™‡∏π‡∏á (22 ‡∏à‡∏∏‡∏î), Security (1 ‡∏à‡∏∏‡∏î)
- ‚ö†Ô∏è v.10: ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û 4‚≠ê, ‡πÅ‡∏ï‡πà Security vulnerabilities ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (5 ‡∏à‡∏∏‡∏î), Duplications (34.8%)
- ‚úÖ v.11: ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û 5‚≠ê (‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î), Security = 0, Duplications = 0.0%, Clean Architecture

**‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï:**
- ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á (v.9: 4‚≠ê ‚Üí v.11: 5‚≠ê)
- v.11 ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏ó‡∏±‡πâ‡∏á 3 ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
- ‡πÅ‡∏ï‡πà v.9 ‡πÅ‡∏•‡∏∞ v.10 ‡∏¢‡∏±‡∏á‡∏°‡∏µ issues ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### 2.2 ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏Ç‡∏≠‡∏á‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤

| Development Method | Versions | Avg Quality | Avg Duplications | Best Version | Issues |
|-------------------|----------|-------------|------------------|--------------|--------|
| **Basic Prompt** | v.3-v.5 | 3.33‚≠ê | 30.4% | v.5 (Reliability: 1) | v.4: Duplications 65.5% |
| **Context Engineering** | v.6-v.8 | 3.67‚≠ê | 4.5% | v.8 (Duplications: 0.0%) | v.6: Reliability 19, Maintainability 26 |
| **SDD** | v.9-v.11 | 4.33‚≠ê | 12.6% | v.11 (5‚≠ê, Best Overall) | v.9: Reliability 22, v.10: Security 5 |

**‡∏™‡∏£‡∏∏‡∏õ:**
- **SDD ‡πÉ‡∏´‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î** - Average Quality 4.33‚≠ê, Best Version (v.11)
- **Context Engineering ‡∏•‡∏î Code Duplications ‡πÑ‡∏î‡πâ‡∏î‡∏µ** - Average 4.5% (v.8: 0.0%)
- **Basic Prompt ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ** - ‡πÅ‡∏ï‡πà Code Duplications ‡∏™‡∏π‡∏á (v.4: 65.5%)

---

## üîç 3. ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏±‡πâ‡∏á 3 ‡∏ß‡∏¥‡∏ò‡∏µ

### 2.1 ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£

| Version | Code Review | SonarQube | Version Analysis | Dev Method | ‡∏™‡∏£‡∏∏‡∏õ |
|---------|-------------|-----------|------------------|------------|------|
| **v.11** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | SDD | ‚úÖ **‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô - ‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î** |
| **v.5** | ‚≠ê‚≠ê‚≠ê‚òÜ‚òÜ | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚òÜ‚òÜ | Basic Prompt | ‚ö†Ô∏è SonarQube ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤ (Reliability: 1) |
| **v.4** | ‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ | ‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ | Basic Prompt | ‚ö†Ô∏è Code Review ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤ ‡πÅ‡∏ï‡πà Duplications ‡∏™‡∏π‡∏á |
| **v.6** | ‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ | ‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ | Context Engineering | ‚ö†Ô∏è Code Review ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤ ‡πÅ‡∏ï‡πà SonarQube ‡∏û‡∏ö issues ‡∏™‡∏π‡∏á |
| **v.8** | ‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ | Context Engineering | ‚úÖ Code Duplications = 0.0% |
| **v.10** | ‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ | ‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ | SDD | ‚ùå SonarQube ‡πÅ‡∏¢‡πà‡∏Å‡∏ß‡πà‡∏≤ (Security: 5) |
| **v.3** | ‚≠ê‚≠ê‚≠ê‚òÜ‚òÜ | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚òÜ‚òÜ | Basic Prompt | ‚úÖ SonarQube ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤ (Maintainability: 7) |

### 2.2 ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á

**‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà Code Review ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏î‡∏µ ‡πÅ‡∏ï‡πà SonarQube ‡∏û‡∏ö issues:**

1. **v.4 (Code Review: 4‚≠ê, SonarQube: Duplications 65.5%)**
   - **‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:** ‡∏°‡∏µ features ‡∏î‡∏µ (Zod, ES Modules, Row Locking) ‡πÅ‡∏ï‡πà‡∏°‡∏µ Code Duplications ‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å
   - **‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:** ‡∏Ñ‡∏ß‡∏£ refactor ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î Code Duplications

2. **v.6 (Code Review: 4‚≠ê, SonarQube: Reliability 19, Maintainability 26)**
   - **‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:** ‡∏°‡∏µ Concurrency Safety (FOR UPDATE) ‡πÅ‡∏ï‡πà SonarQube ‡∏û‡∏ö bugs ‡πÅ‡∏•‡∏∞ code smells ‡∏™‡∏π‡∏á
   - **‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:** ‡∏Ñ‡∏ß‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç bugs ‡πÅ‡∏•‡∏∞ refactor code smells

3. **v.10 (Code Review: 4‚≠ê, SonarQube: Security 5, Duplications 34.8%)**
   - **‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:** ‡∏°‡∏µ Zod, ES Modules ‡πÅ‡∏ï‡πà‡∏°‡∏µ Security vulnerabilities ‡πÅ‡∏•‡∏∞ Code Duplications ‡∏™‡∏π‡∏á
   - **‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:** ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Security issues ‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô

**‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà SonarQube ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏î‡∏µ ‡πÅ‡∏ï‡πà Code Review ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏ö‡∏Å‡∏û‡∏£‡πà‡∏≠‡∏á:**

1. **v.5 (SonarQube: Reliability 1, Code Review: 3‚≠ê)**
   - **‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:** SonarQube metrics ‡∏î‡∏µ‡∏°‡∏≤‡∏Å ‡πÅ‡∏ï‡πà Backend ‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ CommonJS (‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡πá‡∏ô ES Modules)
   - **‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:** ‡∏Ñ‡∏ß‡∏£ migrate ‡πÑ‡∏õ‡πÉ‡∏ä‡πâ ES Modules

---

## üìà 4. ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤

### 4.1 ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÇ‡∏Ñ‡πâ‡∏î

```
v.3 (3‚≠ê) [Basic Prompt] 
  ‚Üí v.4 (4‚≠ê) [Basic Prompt] 
  ‚Üí v.5 (3‚≠ê) [Basic Prompt]
  ‚Üí v.6 (4‚≠ê) [Context Engineering]
  ‚Üí v.7 (3‚≠ê) [Context Engineering]
  ‚Üí v.8 (4‚≠ê) [Context Engineering]
  ‚Üí v.9 (4‚≠ê) [SDD]
  ‚Üí v.10 (4‚≠ê) [SDD]
  ‚Üí v.11 (5‚≠ê) [SDD]
```

**‡∏à‡∏∏‡∏î‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:**
- **v.3 ‚Üí v.4:** ‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î‡∏à‡∏≤‡∏Å 3‚≠ê ‚Üí 4‚≠ê (Basic Prompt - ‡πÄ‡∏û‡∏¥‡πà‡∏° Zod, ES Modules, Row Locking)
- **v.5 ‚Üí v.6:** ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Context Engineering - ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û 4‚≠ê, Code Duplications ‡∏•‡∏î‡∏•‡∏á
- **v.8 ‚Üí v.9:** ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô SDD - ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏Ñ‡∏á‡∏ó‡∏µ‡πà 4‚≠ê ‡πÅ‡∏ï‡πà Architecture ‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô
- **v.10 ‚Üí v.11:** ‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î‡∏à‡∏≤‡∏Å 4‚≠ê ‚Üí 5‚≠ê (SDD - ‡πÄ‡∏û‡∏¥‡πà‡∏° Repository Pattern, Clean Architecture)

### 4.2 Architecture Evolution

```
Monolithic (v.3) [Basic Prompt]
    ‚Üì
Service Layer (v.4-v.10) [Basic Prompt ‚Üí Context Engineering ‚Üí SDD]
    ‚Üì
Repository + Service Pattern (v.11) [SDD] ‚Üê Clean Architecture
```

**‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö Development Method:**
- **Basic Prompt:** Monolithic ‚Üí Service Layer (v.3-v.5)
- **Context Engineering:** Service Layer (v.6-v.8)
- **SDD:** Service Layer ‚Üí Clean Architecture (v.9-v.11)

### 4.3 Features Evolution

**Type Safety:**
- v.2-v.3: ‡πÑ‡∏°‡πà‡∏°‡∏µ validation
- v.4, v.10, v.11: Zod validation
- v.2, v.5: TypeScript (Frontend only)

**Concurrency Safety:**
- v.3-v.4: Basic transactions
- v.4+: Row Locking (FOR UPDATE)
- v.6+: Atomic transactions

**Error Handling:**
- v.3-v.4: Basic error handler
- v.8-v.9: Error handler middleware
- v.11: Error factory pattern

**Money Handling:**
- v.4+: Integer cents math
- v.8+: Integer satang math (THB*100)

---

## üèÜ 5. ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î

### 5.1 v.11 (promotions-app) ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê - SDD

**Code Review:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
- Repository Pattern
- Service Layer
- Error Factory
- Zod Validation
- Money Utilities
- Clean Architecture

**SonarQube:**
- Security: 0 ‚úÖ
- Reliability: 8 ‚úÖ
- Maintainability: 17 ‚ö†Ô∏è
- Duplications: 0.0% ‚úÖ

**Version Analysis:**
- Quality Score: 5‚≠ê
- Features: 10/10
- Architecture: Clean Architecture

**‡∏™‡∏£‡∏∏‡∏õ:** v.11 ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏ó‡∏±‡πâ‡∏á 3 ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå ‚úÖ  
**Development Method:** SDD (Spec-Driven Development) - ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤ SDD ‡πÉ‡∏´‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î

### 5.2 ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à

**v.8 (promotions-discounts-system) - Context Engineering:**
- SonarQube: Duplications = 0.0%, Security = 0
- Code Review: 4‚≠ê (Error Middleware, Money Utils)
- **Development Method:** Context Engineering - ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤ Context Engineering ‡∏•‡∏î Code Duplications ‡πÑ‡∏î‡πâ‡∏î‡∏µ

**v.5 (promo-shop-plug-and-play) - Basic Prompt:**
- SonarQube: Reliability = 1 (‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î), Duplications = 1.4%
- Code Review: 3‚≠ê (Backend ‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ CommonJS)
- **Development Method:** Basic Prompt - ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤ Basic Prompt ‡∏Å‡πá‡πÉ‡∏´‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏î‡∏µ‡πÑ‡∏î‡πâ‡∏ñ‡πâ‡∏≤ prompt ‡∏î‡∏µ

**v.3 (online-shop-inventory) - Basic Prompt:**
- SonarQube: Maintainability = 7 (‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î), Reliability = 3
- Code Review: 3‚≠ê (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ Validation)
- **Development Method:** Basic Prompt - ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ

**v.5 (promo-shop-plug-and-play):**
- SonarQube: Reliability = 1 (‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î), Duplications = 1.4%
- Code Review: 3‚≠ê (Backend ‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ CommonJS)

**v.8 (promotions-discounts-system):**
- SonarQube: Duplications = 0.0%, Security = 0
- Code Review: 4‚≠ê (Error Middleware, Money Utils)

**v.3 (online-shop-inventory):**
- SonarQube: Maintainability = 7 (‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î), Reliability = 3
- Code Review: 3‚≠ê (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ Validation)

---

## ‚ö†Ô∏è 6. ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥

### 6.1 ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç

#### 1. Test Coverage = 0.0% (‡∏ó‡∏∏‡∏Å‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô) ‚ùå

**‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:**
- ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡πÑ‡∏î‡πâ‡∏ß‡πà‡∏≤‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- ‡∏¢‡∏≤‡∏Å‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£ refactor
- ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≠ regression bugs

**‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:**
- ‡πÄ‡∏û‡∏¥‡πà‡∏° Unit Tests ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô (‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: 70-80%)
- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å v.11, v.4, v.6 ‡∏ó‡∏µ‡πà‡∏°‡∏µ test files ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
- ‡πÄ‡∏û‡∏¥‡πà‡∏° Integration Tests

#### 2. Code Duplications ‡∏™‡∏π‡∏á

**v.4: 65.5%** ‚ùå
- ‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô
- ‡∏ï‡πâ‡∏≠‡∏á refactor ‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô

**v.10: 34.8%** ‚ùå
- ‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å ‡∏ï‡πâ‡∏≠‡∏á refactor

**‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:**
- ‡πÉ‡∏ä‡πâ v.11 ‡πÅ‡∏•‡∏∞ v.8 ‡πÄ‡∏õ‡πá‡∏ô reference (Duplications = 0.0%)
- Extract common functions/utilities
- ‡πÉ‡∏ä‡πâ DRY (Don't Repeat Yourself) principle

#### 3. Security Vulnerabilities

**v.10: 5 ‡∏à‡∏∏‡∏î** ‚ùå (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)
- ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô

**v.9: 1 ‡∏à‡∏∏‡∏î** ‚ö†Ô∏è
- ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

**‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:**
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Security vulnerabilities ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Security Hotspots ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 44 ‡∏à‡∏∏‡∏î
- ‡πÉ‡∏ä‡πâ security best practices

#### 4. Reliability Issues

**v.9: 22 ‡∏à‡∏∏‡∏î** ‚ùå (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)
**v.6: 19 ‡∏à‡∏∏‡∏î** ‚ö†Ô∏è

**‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:**
- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç bugs ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ v.9 ‡πÅ‡∏•‡∏∞ v.6
- ‡πÄ‡∏û‡∏¥‡πà‡∏° error handling
- ‡πÄ‡∏û‡∏¥‡πà‡∏° input validation

#### 5. Maintainability Issues

**v.6: 26 ‡∏à‡∏∏‡∏î** ‚ùå (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)
**v.8: 20 ‡∏à‡∏∏‡∏î** ‚ö†Ô∏è

**‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:**
- Refactor code smells
- ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á code structure
- ‡πÉ‡∏ä‡πâ v.3 ‡πÄ‡∏õ‡πá‡∏ô reference (Maintainability = 7)

---

### 6.2 Action Items

#### üî¥ ‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô (High Priority)

1. **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Security vulnerabilities**
   - v.10: 5 ‡∏à‡∏∏‡∏î
   - v.9: 1 ‡∏à‡∏∏‡∏î

2. **Refactor Code Duplications**
   - v.4: 65.5% ‚Üí <10%
   - v.10: 34.8% ‚Üí <10%

#### üü° ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (Medium Priority)

1. **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Reliability issues**
   - v.9: 22 ‡∏à‡∏∏‡∏î ‚Üí <10
   - v.6: 19 ‡∏à‡∏∏‡∏î ‚Üí <10

2. **‡∏•‡∏î Maintainability issues**
   - v.6: 26 ‡∏à‡∏∏‡∏î ‚Üí <15
   - v.8: 20 ‡∏à‡∏∏‡∏î ‚Üí <15

3. **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Security Hotspots**
   - ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 44 ‡∏à‡∏∏‡∏î
   - ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ v.6 (7 ‡∏à‡∏∏‡∏î) ‡πÅ‡∏•‡∏∞ v.11 (6 ‡∏à‡∏∏‡∏î)

#### üü¢ ‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥ (Low Priority)

1. **‡πÄ‡∏û‡∏¥‡πà‡∏° Test Coverage**
   - ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: 70-80%
   - ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å v.11, v.4, v.6

2. **‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á Maintainability**
   - ‡∏ó‡∏∏‡∏Å‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô
   - ‡πÉ‡∏ä‡πâ v.3 ‡πÄ‡∏õ‡πá‡∏ô reference

---

## üí° 7. Best Practices ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÑ‡∏î‡πâ

### 7.1 ‡∏à‡∏≤‡∏Å v.11 (Best Version - SDD)

1. **Repository Pattern**
   ```javascript
   // ‡πÅ‡∏¢‡∏Å data access layer
   const cart = await cartRepository.getCartByUserId(userId);
   ```

2. **Service Layer**
   ```javascript
   // ‡πÅ‡∏¢‡∏Å business logic
   const result = await promotionService.applyCoupon({ userId, couponCode });
   ```

3. **Error Factory**
   ```javascript
   // Structured error handling
   throw errorFactory.expired();
   throw errorFactory.minSpend();
   ```

4. **Zod Validation**
   ```javascript
   // Type-safe input validation
   const schema = z.object({
     productId: z.number().int().positive(),
   });
   ```

### 7.2 ‡∏à‡∏≤‡∏Å v.4 (‡∏à‡∏∏‡∏î‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç - Basic Prompt)

1. **Transaction Helper**
   ```javascript
   export async function withTx(fn) {
     const client = await pool.connect();
     try {
       await client.query("BEGIN");
       const result = await fn(client);
       await client.query("COMMIT");
       return result;
     } catch (err) {
       await client.query("ROLLBACK");
       throw err;
     } finally {
       client.release();
     }
   }
   ```

2. **Row Locking**
   ```javascript
   // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô race condition
   const productRes = await client.query(
     "SELECT id, stock FROM products WHERE id=$1 FOR UPDATE",
     [productId]
   );
   ```

3. **Integer Cents Math**
   ```javascript
   // ‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ floating point errors
   const price_cents = 1999; // $19.99
   ```

### 7.3 ‡∏à‡∏≤‡∏Å v.6 (Concurrency Safety - Context Engineering)

1. **Atomic Transactions**
   ```javascript
   await client.query("BEGIN");
   // ... update stock and logs in same transaction
   await client.query("COMMIT");
   ```

2. **Overselling Prevention**
   ```javascript
   if (quantity > product.stock) {
     await client.query("ROLLBACK");
     return res.status(409).json({ error: "Insufficient stock" });
   }
   ```

---

## üî¨ 8. Code Evolution Analysis: ‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Å‡∏•‡∏∏‡πà‡∏° Scenario

### 8.1 ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°

‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Å‡∏•‡∏∏‡πà‡∏° scenario ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô ‡πÇ‡∏î‡∏¢‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 3 ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤:

**‡∏Å‡∏•‡∏∏‡πà‡∏° Scenario:**
1. **Inventory Management** (v.3, v.6, v.9) - `scenarios_inventory.md`
2. **Shopping Cart** (v.4, v.7, v.10) - `scenarios_cart.md`
3. **Promotions & Discounts** (v.5, v.8, v.11) - `scenarios_promotions.md`

---

### 8.2 Inventory Management System (v.3, v.6, v.9)

#### Scenario: Stock Deduction (‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å)

**v.3 (Basic Prompt) - `inventoryController.js`**

```javascript
// POST /api/purchase
async function purchase(req, res) {
  const client = await pool.connect();
  try {
    await client.query("BEGIN");
    
    // Lock product row
    const pr = await client.query(
      `SELECT id, name, stock FROM products WHERE id = $1 FOR UPDATE`,
      [productId]
    );
    
    // Basic stock check
    if (before < quantity) {
      await client.query("ROLLBACK");
      return res.status(409).json({ error: "Not enough stock" });
    }
    
    // Update stock + Log history
    await client.query(`UPDATE products SET stock = $1 WHERE id = $2`, [after, productId]);
    await client.query(`INSERT INTO stock_history ...`, [...]);
    
    await client.query("COMMIT");
    
    // ‚ùå Low stock alert ‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å transaction (‡πÑ‡∏°‡πà atomic!)
    if (after < threshold()) {
      console.log(`[LOW STOCK] productId=${productId} stock=${after}`);
    }
  } catch (e) {
    await client.query("ROLLBACK");
    console.error("purchase:", e);  // ‚ùå Basic error handling
    return res.status(500).json({ error: "Server error" });
  }
}
```

**‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô:** ‚úÖ FOR UPDATE, ‚úÖ Transaction, ‚úÖ Stock validation  
**‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á:** ‚ùå Low stock alert ‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å transaction, ‚ùå Error handling ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö

---

**v.6 (Context Engineering) - `app.js`**

```javascript
app.post("/api/purchase", async (req, res) => {
  // Configurable threshold
  const threshold = Number.isFinite(Number(process.env.LOW_STOCK_THRESHOLD))
    ? Number(process.env.LOW_STOCK_THRESHOLD)
    : 5;

  const client = await pool.connect();
  try {
    await client.query("BEGIN");
    
    // Lock product row (includes low_stock_threshold)
    const { rows } = await client.query(
      `SELECT id, stock, low_stock_threshold FROM products WHERE id = $1 FOR UPDATE`,
      [productId]
    );
    
    // Overselling prevention: validate BEFORE any write
    if (quantity > product.stock) {
      await client.query("ROLLBACK");
      return res.status(409).json({
        error: "Insufficient stock",
        available: product.stock,
        requested: quantity
      });
    }
    
    // Update stock + SALE log (same transaction => atomic)
    await client.query(`UPDATE products SET stock = $1 WHERE id = $2`, [remainingStock, productId]);
    await client.query(`INSERT INTO inventory_log ...`, [...]);
    
    // ‚úÖ Low stock alert trigger (STRICT <=) - INSIDE transaction!
    const lowStockAlertTriggered = remainingStock <= threshold;
    if (lowStockAlertTriggered) {
      await client.query(`INSERT INTO inventory_log ...`, [...]);
    }
    
    await client.query("COMMIT");
    
    return res.json({
      ok: true,
      remainingStock,
      lowStockAlertTriggered,  // ‚úÖ Response ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö
      lowStockThresholdUsed: threshold
    });
  } catch (err) {
    try { await client.query("ROLLBACK"); } catch (_) {}
    return res.status(500).json({ 
      error: "Purchase failed (rolled back)", 
      details: err.message  // ‚úÖ Better error messages
    });
  }
});
```

**‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏à‡∏≤‡∏Å v.3:**
- ‚úÖ **Low stock alert ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô transaction** - Atomic!
- ‚úÖ **‡πÉ‡∏ä‡πâ low_stock_threshold ‡∏à‡∏≤‡∏Å database** - ‡πÑ‡∏°‡πà hardcode
- ‚úÖ **Boundary check ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á** - ‡πÉ‡∏ä‡πâ `<=` (STRICT)
- ‚úÖ **Error messages ‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô** - ‡∏°‡∏µ details
- ‚úÖ **Response ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö** - lowStockAlertTriggered, threshold

**‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á:**
- ‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ service layer
- ‚ùå Error handling ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
- ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ structured error codes

---

**v.9 (SDD) - `stockService.js`**

```javascript
const { withTransaction } = require('../db');
const inventoryRepository = require('../repositories/inventoryRepository');
const inventoryLogRepository = require('../repositories/inventoryLogRepository');
const stockAlertRepository = require('../repositories/stockAlertRepository');
const { logInfo } = require('../utils/logger');

const STOCK_CHANGE_TYPES = {
  SALE: 'SALE',
  RESTOCK_RETURN: 'RESTOCK_RETURN',
};

const deductStock = async ({ sku, quantity, orderId }) =>
  withTransaction(async (client) => {
    // ‚úÖ Repository pattern - clean data access
    const item = await inventoryRepository.getBySku(client, sku, true);
    if (!item) {
      const error = new Error('SKU not found.');
      error.status = 404;
      error.code = 'sku_not_found';  // ‚úÖ Structured error code
      throw error;
    }

    if (quantity > item.quantity) {
      const error = new Error('Insufficient stock.');
      error.status = 409;
      error.code = 'insufficient_stock';  // ‚úÖ Structured error code
      throw error;
    }

    const newQuantity = item.quantity - quantity;
    
    // ‚úÖ Repository pattern
    const updated = await inventoryRepository.updateQuantity(client, sku, newQuantity);
    const log = await inventoryLogRepository.createLog(client, {
      sku,
      changeType: STOCK_CHANGE_TYPES.SALE,
      quantityDelta: -quantity,
      orderId,
    });

    // ‚úÖ Low stock alert - atomic in transaction
    if (updated.quantity <= updated.low_stock_threshold) {
      await stockAlertRepository.createAlert(client, {
        sku,
        threshold: updated.low_stock_threshold,
        quantity: updated.quantity,
      });
      logInfo('Low stock alert created', {  // ‚úÖ Structured logging
        sku,
        quantity: updated.quantity,
        threshold: updated.low_stock_threshold,
      });
    }

    logInfo('Stock deducted', {  // ‚úÖ Structured logging
      sku,
      quantity,
      newQuantity: updated.quantity,
      orderId,
    });

    return { updated, logId: log.id };
  });
```

**‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏à‡∏≤‡∏Å v.6:**
- ‚úÖ **Repository Pattern** - ‡πÅ‡∏¢‡∏Å data access layer
- ‚úÖ **Service Layer** - ‡πÅ‡∏¢‡∏Å business logic
- ‚úÖ **Structured Error Codes** - `sku_not_found`, `insufficient_stock`
- ‚úÖ **Structured Logging** - `logInfo()` ‡πÅ‡∏ó‡∏ô `console.log`
- ‚úÖ **Constants** - `STOCK_CHANGE_TYPES` ‡πÅ‡∏ó‡∏ô hardcode strings
- ‚úÖ **Transaction Helper** - `withTransaction()` ‡πÅ‡∏ó‡∏ô manual BEGIN/COMMIT

**‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô:**
- ‚úÖ ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡πÅ‡∏•‡∏∞ maintainable
- ‚úÖ ‡πÅ‡∏¢‡∏Å concerns ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô (Repository, Service, Controller)
- ‚úÖ Error handling ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
- ‚úÖ Logging ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö

---

#### üìä ‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö Inventory Management

| Feature | v.3 (Basic Prompt) | v.6 (Context Engineering) | v.9 (SDD) |
|---------|-------------------|---------------------------|-----------|
| **Row Locking** | ‚úÖ FOR UPDATE | ‚úÖ FOR UPDATE | ‚úÖ FOR UPDATE (via Repository) |
| **Transaction** | ‚úÖ Manual | ‚úÖ Manual | ‚úÖ Helper (`withTransaction`) |
| **Low Stock Alert** | ‚ùå Outside transaction | ‚úÖ Inside transaction | ‚úÖ Inside transaction + Repository |
| **Error Handling** | ‚ùå Basic (console.error) | ‚ö†Ô∏è Better messages | ‚úÖ Structured error codes |
| **Architecture** | ‚ùå Monolithic | ‚ö†Ô∏è Better structure | ‚úÖ Repository + Service Pattern |
| **Logging** | ‚ùå console.log | ‚ùå console.log | ‚úÖ Structured logging |
| **Code Organization** | ‚ùå All in controller | ‚ùå All in route handler | ‚úÖ Separated (Repository, Service, Controller) |

**‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à:**
1. **v.3 ‚Üí v.6:** Low stock alert ‡∏¢‡πâ‡∏≤‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤ transaction (Atomic!) ‚≠ê
2. **v.6 ‚Üí v.9:** Architecture ‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏Å (Repository Pattern) ‚≠ê
3. **v.9:** ‡∏°‡∏µ structured error codes ‡πÅ‡∏•‡∏∞ logging ‚≠ê

---

### 8.3 Shopping Cart System (v.4, v.7, v.10)

#### Scenario: Add to Cart (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤)

**v.4 (Basic Prompt) - `cartService.js`**

```javascript
export async function addToCart(productId, qty) {
  return withTx(async (client) => {
    const cartId = await ensureDemoCart(client);

    // Lock product row to safely check stock
    const productRes = await client.query(
      "SELECT id, stock, price_cents FROM products WHERE id=$1 FOR UPDATE",
      [productId]
    );
    
    // Get existing cart item (lock row if exists)
    const itemRes = await client.query(
      "SELECT qty, saved_for_later FROM cart_items WHERE cart_id=$1 AND product_id=$2 FOR UPDATE",
      [cartId, productId]
    );

    const existingQty = itemRes.rows.length ? itemRes.rows[0].qty : 0;
    const desiredQty = existingQty + qty;

    // Stock validation
    if (desiredQty > product.stock) {
      const err = new Error(`Not enough stock. Available: ${product.stock}`);
      err.status = 409;
      throw err;
    }

    // Insert or Update
    if (itemRes.rows.length === 0) {
      await client.query(`INSERT INTO cart_items ...`, [...]);
    } else {
      await client.query(`UPDATE cart_items SET qty=$3 ...`, [...]);
    }

    return await getCart(client);
  });
}
```

**‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô:** ‚úÖ Service Layer, ‚úÖ Transaction Helper (`withTx`), ‚úÖ Row Locking, ‚úÖ Zod Validation  
**‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á:** ‚ö†Ô∏è Error messages ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö

---

**v.7 (Context Engineering) - `server.js`**

```javascript
app.post("/api/cart/items", async (req, res) => {
  const sku = String(req.body?.sku || "").trim();
  const addQty = asInt(req.body?.quantity);

  // ‚úÖ Structured error responses
  if (!sku) return apiError(res, 400, "BAD_REQUEST", "sku is required");
  if (addQty == null || addQty <= 0) {
    return apiError(res, 400, "BAD_REQUEST", "quantity must be a positive integer");
  }

  const client = await pool.connect();
  try {
    await client.query("BEGIN");

    // Lock product row
    const prodRes = await client.query(
      `SELECT sku, stock FROM products WHERE sku = $1 FOR UPDATE;`,
      [sku]
    );
    
    // Lock cart item row (if exists)
    const itemRes = await client.query(
      `SELECT quantity FROM cart_items WHERE cart_id = $1 AND sku = $2 FOR UPDATE;`,
      [DEMO_CART_ID, sku]
    );

    const currentQty = itemRes.rowCount ? Number(itemRes.rows[0].quantity) : 0;

    // ‚úÖ Inventory Guard: (CurrentCartQty + NewQty) <= Stock
    if (currentQty + addQty > stock) {
      await client.query("ROLLBACK");
      return apiError(res, 409, "INSUFFICIENT_STOCK", "Insufficient Stock", {
        sku,
        stock,
        currentCartQty: currentQty,
        requestedAddQty: addQty,
        maxAddQty: Math.max(0, stock - currentQty)  // ‚úÖ Helpful error details
      });
    }

    // Insert or Update
    if (itemRes.rowCount) {
      await client.query(`UPDATE cart_items SET quantity = quantity + $3, status = 'ACTIVE' ...`, [...]);
    } else {
      await client.query(`INSERT INTO cart_items ...`, [...]);
    }

    await client.query("COMMIT");
    const snap = await getCartSnapshot(client, DEMO_CART_ID);
    res.json({ ok: true, cart: snap });
  } catch (e) {
    await client.query("ROLLBACK");
    console.error(e);
    apiError(res, 500, "SERVER_ERROR", "Unexpected error");
  } finally {
    client.release();
  }
});
```

**‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏à‡∏≤‡∏Å v.4:**
- ‚úÖ **Structured Error Responses** - `apiError()` function
- ‚úÖ **Error Codes** - `BAD_REQUEST`, `NOT_FOUND`, `INSUFFICIENT_STOCK`
- ‚úÖ **Helpful Error Details** - `maxAddQty` ‡πÉ‡∏ô error response
- ‚úÖ **Status Management** - `status = 'ACTIVE'`
- ‚úÖ **Better Comments** - "Inventory Guard" comment

**‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á:**
- ‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ Service Layer (‡πÇ‡∏Ñ‡πâ‡∏î‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô route handler)
- ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ Transaction Helper

---

**v.10 (SDD) - `cartService.js`**

```javascript
export async function addToCart(productId, qty) {
  return withTx(async (client) => {
    const cartId = await ensureDemoCart(client);

    const productRes = await client.query(
      "SELECT id, stock, price_cents FROM products WHERE id=$1 FOR UPDATE",
      [productId]
    );
    
    const itemRes = await client.query(
      "SELECT qty, saved_for_later FROM cart_items WHERE cart_id=$1 AND product_id=$2 FOR UPDATE",
      [cartId, productId]
    );

    const existingQty = itemRes.rows.length ? itemRes.rows[0].qty : 0;
    const desiredQty = existingQty + qty;

    // ‚úÖ Extracted validation function
    assertStockAvailable(desiredQty, product.stock);

    // Insert or Update
    if (itemRes.rows.length === 0) {
      await client.query(`INSERT INTO cart_items ...`, [...]);
    } else {
      await client.query(`UPDATE cart_items SET qty=$3 ...`, [...]);
    }

    return await getCart(client);
  });
}

// ‚úÖ Extracted validation function
function assertStockAvailable(desiredQty, stock) {
  if (desiredQty > stock) {
    const err = new Error(`Not enough stock. Available: ${stock}`);
    err.status = 409;
    throw err;
  }
}
```

**‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏à‡∏≤‡∏Å v.7:**
- ‚úÖ **Service Layer** - ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏ä‡πâ service layer (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô v.4)
- ‚úÖ **Transaction Helper** - ‡πÉ‡∏ä‡πâ `withTx()` (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô v.4)
- ‚úÖ **Extracted Functions** - `assertStockAvailable()` - DRY principle
- ‚úÖ **Cleaner Code** - ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏±‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô

**‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô:**
- ‚úÖ ‡∏£‡∏ß‡∏°‡∏à‡∏∏‡∏î‡∏î‡∏µ‡∏Ç‡∏≠‡∏á v.4 (Service Layer, Transaction Helper) ‡∏Å‡∏±‡∏ö v.7 (Better error handling)
- ‚úÖ ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡πÅ‡∏•‡∏∞ maintainable

---

#### üìä ‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö Shopping Cart

| Feature | v.4 (Basic Prompt) | v.7 (Context Engineering) | v.10 (SDD) |
|---------|-------------------|---------------------------|------------|
| **Service Layer** | ‚úÖ Yes | ‚ùå No | ‚úÖ Yes |
| **Transaction Helper** | ‚úÖ `withTx()` | ‚ùå Manual | ‚úÖ `withTx()` |
| **Row Locking** | ‚úÖ FOR UPDATE | ‚úÖ FOR UPDATE | ‚úÖ FOR UPDATE |
| **Error Handling** | ‚ö†Ô∏è Basic | ‚úÖ Structured (`apiError`) | ‚ö†Ô∏è Basic (‡πÅ‡∏ï‡πà‡∏°‡∏µ Zod) |
| **Error Codes** | ‚ùå No | ‚úÖ Yes | ‚ö†Ô∏è Status codes only |
| **Validation** | ‚úÖ Zod | ‚ö†Ô∏è Manual | ‚úÖ Zod |
| **Code Organization** | ‚úÖ Service Layer | ‚ùå Route handler | ‚úÖ Service Layer |
| **Extracted Functions** | ‚ùå No | ‚ùå No | ‚úÖ `assertStockAvailable()` |

**‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à:**
1. **v.4 ‚Üí v.7:** ‡πÄ‡∏û‡∏¥‡πà‡∏° structured error handling ‡πÅ‡∏ï‡πà‡πÄ‡∏™‡∏µ‡∏¢ Service Layer
2. **v.7 ‚Üí v.10:** ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏ä‡πâ Service Layer + Transaction Helper + Extracted Functions
3. **v.10:** ‡∏£‡∏ß‡∏°‡∏à‡∏∏‡∏î‡∏î‡∏µ‡∏Ç‡∏≠‡∏á v.4 ‡πÅ‡∏•‡∏∞ v.7 ‚≠ê

---

### 8.4 Promotions & Discounts System (v.5, v.8, v.11)

#### Scenario: Apply Coupon (‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á)

**v.5 (Basic Prompt) - `server.js`**

```javascript
async function buildQuote(client, { userId, items, couponCode }, { consumeOnConfirm, autoDiscountPercent }) {
  const errors = [];  // ‚ùå Error handling ‡πÅ‡∏ö‡∏ö array
  const messages = [];

  // Load products
  const { rows: products } = await client.query(
    `SELECT id, name, price_satang, stock FROM products WHERE id = ANY($1::text[])`,
    [ids]
  );

  // Build line items + subtotal
  let subtotal = 0;
  const lineItems = [];
  for (const it of normItems) {
    const p = map.get(it.productId);
    if (!p) { errors.push(`Unknown product: ${it.productId}.`); continue; }
    if (it.qty > p.stock) {
      errors.push(`Out of stock: ${p.name} (available ${p.stock}).`);
    }
    // ... build line items
  }

  // Coupon usage count
  const code = normalizeCode(couponCode);
  let usedCount = 0;
  if (code && uid) {
    const r = await client.query(
      `SELECT used_count FROM coupon_usage WHERE user_id=$1 AND coupon_code=$2`,
      [uid, code]
    );
    usedCount = r.rows?.[0]?.used_count ?? 0;
  }

  const { coupon, errors: couponErrors, messages: couponMessages } = validateCoupon({
    code,
    subtotal_satang: subtotal,
    userUsedCount: usedCount
  });

  errors.push(...couponErrors);
  messages.push(...couponMessages);

  const totals = computeTotals(subtotal, coupon, autoDiscountPercent);

  return { lineItems, totals, errors, messages };
}
```

**‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô:** ‚úÖ ‡∏°‡∏µ coupon validation, ‚úÖ ‡∏°‡∏µ usage count check, ‚úÖ ‡∏°‡∏µ order of operations  
**‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á:** ‚ùå ‡πÇ‡∏Ñ‡πâ‡∏î‡∏¢‡∏≤‡∏ß‡∏°‡∏≤‡∏Å (all-in-one function), ‚ùå Error handling ‡πÅ‡∏ö‡∏ö array, ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ structured error codes

---

**v.8 (Context Engineering) - `applyCouponController.js`**

```javascript
async function applyCoupon(req, res, next) {
  try {
    const { userId, orderId, couponCode } = req.body || {};

    if (!userId || !orderId || !couponCode || typeof couponCode !== "string") {
      return res.status(400).json({ 
        error: "INVALID_REQUEST", 
        message: "userId, orderId, couponCode are required" 
      });
    }

    // 1) Load order (and ensure it belongs to user)
    const orderResult = await db.query(`SELECT ... FROM orders WHERE id = $1`, [orderId]);
    if (orderResult.rowCount === 0) {
      return res.status(404).json({ error: "ORDER_NOT_FOUND", message: "Order not found" });
    }

    // 2) Load coupon
    const couponResult = await db.query(`SELECT ... FROM coupons WHERE code = $1`, [couponCode.trim().toUpperCase()]);
    if (couponResult.rowCount === 0) {
      return res.status(400).json({ error: "COUPON_INVALID", message: "Invalid coupon code" });
    }

    // 3) Expiry check
    if (coupon.expires_at) {
      const now = new Date();
      const expires = new Date(coupon.expires_at);
      if (now.getTime() > expires.getTime()) {
        return res.status(400).json({ error: "COUPON_EXPIRED", message: "Coupon has expired" });
      }
    }

    // 4) Minimum purchase check
    const minPurchase = parseInt(coupon.min_purchase_satang, 10);
    if (original < minPurchase) {
      return res.status(400).json({
        error: "MIN_PURCHASE_NOT_MET",
        message: `Minimum purchase not met`,
        min_purchase_satang: minPurchase,
      });
    }

    // 5) One-time per user policy
    if (coupon.one_time_per_user) {
      const used = await db.query(
        `SELECT 1 FROM user_coupon_history WHERE user_id = $1 AND coupon_id = $2 LIMIT 1`,
        [userId, coupon.id]
      );
      if (used.rowCount > 0) {
        return res.status(400).json({ 
          error: "COUPON_OVERUSED", 
          message: "Coupon already used by this user" 
        });
      }
    }

    // 6) Sequenced calculation (integer satang)
    const percentDiscount = calcPercentDiscount(original, percentBps);
    const afterPercent = original - percentDiscount;
    const afterFixed = afterPercent - fixedSatang;
    const grandTotal = Math.max(0, afterFixed);  // ‚úÖ Negative protection

    // 7) Persist: update order + insert history (transaction)
    await db.query("BEGIN");
    await db.query(`UPDATE orders SET ...`, [...]);
    await db.query(`INSERT INTO user_coupon_history ...`, [...]);
    await db.query("COMMIT");

    res.json({ ok: true, order: updated.rows[0], message: "Coupon applied successfully" });
  } catch (err) {
    await db.query("ROLLBACK");
    next(err);
  }
}
```

**‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏à‡∏≤‡∏Å v.5:**
- ‚úÖ **Structured Error Codes** - `COUPON_INVALID`, `COUPON_EXPIRED`, `MIN_PURCHASE_NOT_MET`
- ‚úÖ **Better Organization** - ‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô steps (1-7) ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
- ‚úÖ **Better Comments** - ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÅ‡∏ï‡πà‡∏•‡∏∞ step
- ‚úÖ **Transaction** - ‡∏°‡∏µ transaction ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö persistence
- ‚úÖ **Order of Operations** - ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô (percent ‚Üí fixed)
- ‚úÖ **Negative Protection** - `Math.max(0, afterFixed)`
- ‚úÖ **Audit Trail** - `user_coupon_history`

**‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á:**
- ‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ Service Layer (‡πÇ‡∏Ñ‡πâ‡∏î‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô controller)
- ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ Repository Pattern

---

**v.11 (SDD) - `promotionService.js`**

```javascript
const couponRepository = require('../repositories/couponRepository');
const cartRepository = require('../repositories/cartRepository');
const usageRepository = require('../repositories/couponUsageRepository');
const eventRepository = require('../repositories/eventRepository');
const { percentOf, clampZero, sumCents } = require('../utils/money');
const { errorFactory } = require('../utils/errors');

// ‚úÖ Extracted validation functions
function validateDateWindow(coupon) {
  const now = new Date();
  if (now < coupon.start_at || now > coupon.end_at) {
    throw errorFactory.expired();
  }
}

function validateMinimum(cart, coupon) {
  if (cart.subtotal_cents < coupon.min_subtotal_cents) {
    throw errorFactory.minSpend();
  }
}

async function validateUsage(userId, coupon) {
  const usage = await usageRepository.getUsage(userId, coupon.code);
  if (usage && usage.times_used >= coupon.usage_limit_per_user) {
    throw errorFactory.usageLimit();
  }
}

function computeDiscountAmount(cart, coupon) {
  if (coupon.type === 'percent') {
    return percentOf(cart.subtotal_cents, coupon.value_percent);
  }
  return coupon.value_cents;
}

// ‚úÖ Clean service function
async function applyCoupon({ userId, couponCode }) {
  const normalizedCode = couponCode.trim().toUpperCase();
  try {
    // ‚úÖ Repository pattern
    const cart = await cartRepository.getCartByUserId(userId);
    const coupon = await couponRepository.findByCode(normalizedCode);
    
    // Check for duplicate
    const existingDiscount = await cartRepository.findDiscountByCode(cart.id, normalizedCode);
    if (existingDiscount) {
      throw errorFactory.duplicate();
    }

    // ‚úÖ Validation (extracted functions)
    validateDateWindow(coupon);
    validateMinimum(cart, coupon);
    await validateUsage(userId, coupon);

    // Compute discount
    const discountAmount = computeDiscountAmount(cart, coupon);
    const priority = determinePriority(coupon);

    // Persist discount line
    await cartRepository.addDiscountLine(cart.id, {
      couponCode: normalizedCode,
      amountCents: discountAmount,
      priority,
      discountType: coupon.type,
      reason: 'applied',
    });

    // Increment usage
    await usageRepository.incrementUsage(userId, normalizedCode);

    // Calculate totals
    const discounts = await cartRepository.getDiscounts(cart.id);
    const totalDiscount = clampZero(sumCents(discounts.map((d) => d.amount_cents)));
    const grand = clampZero(cart.subtotal_cents - totalDiscount);

    // ‚úÖ Event logging
    await eventRepository.logEvent({
      couponCode: normalizedCode,
      userId,
      status: 'applied',
      reason: 'success',
      deltaCents: discountAmount,
    });

    return {
      discountAmount,
      message: '‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
      grandTotalCents: grand,
    };
  } catch (error) {
    // ‚úÖ Event logging for failures
    await eventRepository.logEvent({
      couponCode: normalizedCode,
      userId,
      status: 'rejected',
      reason: error.reason || 'error',
      deltaCents: 0,
    });
    throw error;
  }
}
```

**‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏à‡∏≤‡∏Å v.8:**
- ‚úÖ **Repository Pattern** - ‡πÅ‡∏¢‡∏Å data access layer
- ‚úÖ **Service Layer** - ‡πÅ‡∏¢‡∏Å business logic
- ‚úÖ **Error Factory** - `errorFactory.expired()`, `errorFactory.minSpend()`
- ‚úÖ **Extracted Functions** - `validateDateWindow()`, `validateMinimum()`, `validateUsage()`
- ‚úÖ **Money Utilities** - `percentOf()`, `clampZero()`, `sumCents()`
- ‚úÖ **Event Logging** - `eventRepository.logEvent()` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö audit
- ‚úÖ **Clean Code** - ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏±‡πâ‡∏ô ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ maintainable

**‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô:**
- ‚úÖ Clean Architecture (Repository + Service)
- ‚úÖ Error handling ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (Error Factory)
- ‚úÖ Code organization ‡∏î‡∏µ‡∏°‡∏≤‡∏Å (Extracted Functions)
- ‚úÖ Event logging ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö audit trail

---

#### üìä ‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö Promotions & Discounts

| Feature | v.5 (Basic Prompt) | v.8 (Context Engineering) | v.11 (SDD) |
|---------|-------------------|---------------------------|------------|
| **Service Layer** | ‚ùå No | ‚ùå No | ‚úÖ Yes |
| **Repository Pattern** | ‚ùå No | ‚ùå No | ‚úÖ Yes |
| **Error Handling** | ‚ùå Array (errors.push) | ‚úÖ Structured codes | ‚úÖ Error Factory |
| **Error Codes** | ‚ùå No | ‚úÖ Yes | ‚úÖ Error Factory |
| **Code Organization** | ‚ùå All-in-one | ‚ö†Ô∏è Steps (1-7) | ‚úÖ Extracted Functions |
| **Validation** | ‚ö†Ô∏è Mixed in function | ‚ö†Ô∏è Inline | ‚úÖ Extracted Functions |
| **Money Utilities** | ‚ö†Ô∏è Inline | ‚ö†Ô∏è Inline | ‚úÖ `percentOf()`, `clampZero()` |
| **Event Logging** | ‚ùå No | ‚ùå No | ‚úÖ Yes |
| **Transaction** | ‚ö†Ô∏è Partial | ‚úÖ Yes | ‚úÖ Yes (via Repository) |

**‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à:**
1. **v.5 ‚Üí v.8:** ‡πÄ‡∏û‡∏¥‡πà‡∏° structured error codes ‡πÅ‡∏•‡∏∞ better organization
2. **v.8 ‚Üí v.11:** ‡πÄ‡∏û‡∏¥‡πà‡∏° Repository Pattern, Error Factory, Extracted Functions
3. **v.11:** Clean Architecture - ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡πÅ‡∏•‡∏∞ maintainable ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‚≠ê

---

### 8.5 ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå Code Evolution

#### 8.5.1 ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÇ‡∏Ñ‡πâ‡∏î‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô

**1. Architecture Evolution**

```
Monolithic/All-in-one (v.3, v.4, v.5)
    ‚Üì
Better Structure (v.6, v.7, v.8)
    ‚Üì
Clean Architecture (v.9, v.10, v.11) ‚úÖ
```

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:**
- **v.3:** All in controller
- **v.6:** Better structure ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ service layer
- **v.9:** Repository + Service Pattern ‚úÖ

**2. Error Handling Evolution**

```
console.error / errors.push (v.3, v.5)
    ‚Üì
Structured error codes (v.6, v.7, v.8)
    ‚Üì
Error Factory Pattern (v.9, v.11) ‚úÖ
```

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:**
- **v.3:** `console.error("purchase:", e)`
- **v.8:** `error: "COUPON_EXPIRED", message: "Coupon has expired"`
- **v.11:** `throw errorFactory.expired()` ‚úÖ

**3. Code Organization Evolution**

```
Long functions (all-in-one) (v.5)
    ‚Üì
Better comments and steps (v.8)
    ‚Üì
Extracted Functions (v.10, v.11) ‚úÖ
```

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:**
- **v.5:** `buildQuote()` function ‡∏¢‡∏≤‡∏ß‡∏°‡∏≤‡∏Å (all-in-one)
- **v.8:** ‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô steps (1-7) ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô function ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
- **v.11:** `validateDateWindow()`, `validateMinimum()`, `validateUsage()` - Extracted Functions ‚úÖ

**4. Transaction & Atomicity**

```
Manual transaction + Alert outside (v.3) ‚ùå
    ‚Üì
Manual transaction + Alert inside (v.6) ‚úÖ
    ‚Üì
Transaction Helper + Repository (v.9, v.11) ‚úÖ
```

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:**
- **v.3:** Low stock alert ‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å transaction ‚ùå
- **v.6:** Low stock alert ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô transaction ‚úÖ
- **v.9:** Transaction Helper (`withTransaction`) + Repository Pattern ‚úÖ

**5. Data Access Layer**

```
Direct SQL queries (v.3, v.4, v.5)
    ‚Üì
Better SQL organization (v.6, v.7, v.8)
    ‚Üì
Repository Pattern (v.9, v.11) ‚úÖ
```

---

#### 8.5.2 ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©

**üîç Group 1: Inventory Management (v.3, v.6, v.9)**

1. **Low Stock Alert - Atomicity**
   - **v.3:** ‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å transaction (‡πÑ‡∏°‡πà atomic) ‚ùå
   - **v.6:** ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô transaction (atomic) ‚úÖ
   - **v.9:** ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô transaction + Repository Pattern ‚úÖ

2. **Error Handling**
   - **v.3:** `console.error()` ‚ùå
   - **v.6:** Better error messages
   - **v.9:** Structured error codes (`sku_not_found`, `insufficient_stock`) ‚úÖ

3. **Architecture**
   - **v.3:** Monolithic
   - **v.6:** Better structure
   - **v.9:** Repository + Service Pattern (Clean Architecture) ‚úÖ

**‡∏™‡∏£‡∏∏‡∏õ:** v.9 ‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏î‡πâ‡∏≤‡∏ô - Architecture, Error Handling, Atomicity

---

**üîç Group 2: Shopping Cart (v.4, v.7, v.10)**

1. **Service Layer**
   - **v.4:** ‡∏°‡∏µ Service Layer ‚úÖ
   - **v.7:** ‡πÑ‡∏°‡πà‡∏°‡∏µ Service Layer (‡πÇ‡∏Ñ‡πâ‡∏î‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô route handler) ‚ùå
   - **v.10:** ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏ä‡πâ Service Layer ‚úÖ

2. **Error Handling**
   - **v.4:** Basic error handling
   - **v.7:** Structured error codes (`BAD_REQUEST`, `INSUFFICIENT_STOCK`) + Helpful details ‚úÖ
   - **v.10:** Basic error handling ‡πÅ‡∏ï‡πà‡∏°‡∏µ Zod validation

3. **Code Organization**
   - **v.4:** Service Layer ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ extracted functions
   - **v.7:** Better error handling ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ service layer
   - **v.10:** Service Layer + Extracted Functions (`assertStockAvailable()`) ‚úÖ

**‡∏™‡∏£‡∏∏‡∏õ:** v.10 ‡∏£‡∏ß‡∏°‡∏à‡∏∏‡∏î‡∏î‡∏µ‡∏Ç‡∏≠‡∏á v.4 (Service Layer) ‡πÅ‡∏•‡∏∞ v.7 (Better error handling) + Extracted Functions

---

**üîç Group 3: Promotions & Discounts (v.5, v.8, v.11)**

1. **Code Organization**
   - **v.5:** All-in-one function (`buildQuote()` ‡∏¢‡∏≤‡∏ß‡∏°‡∏≤‡∏Å) ‚ùå
   - **v.8:** ‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô steps (1-7) ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô function ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
   - **v.11:** Extracted Functions (`validateDateWindow()`, `validateMinimum()`, `validateUsage()`) ‚úÖ

2. **Error Handling**
   - **v.5:** Error array (`errors.push()`) ‚ùå
   - **v.8:** Structured error codes (`COUPON_EXPIRED`, `MIN_PURCHASE_NOT_MET`) ‚úÖ
   - **v.11:** Error Factory Pattern (`errorFactory.expired()`, `errorFactory.minSpend()`) ‚úÖ

3. **Architecture**
   - **v.5:** Monolithic (all-in-one)
   - **v.8:** Better structure ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ service layer
   - **v.11:** Repository + Service Pattern (Clean Architecture) ‚úÖ

4. **Event Logging**
   - **v.5:** ‡πÑ‡∏°‡πà‡∏°‡∏µ
   - **v.8:** ‡πÑ‡∏°‡πà‡∏°‡∏µ
   - **v.11:** `eventRepository.logEvent()` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö audit trail ‚úÖ

**‡∏™‡∏£‡∏∏‡∏õ:** v.11 ‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏î‡πâ‡∏≤‡∏ô - Architecture, Error Handling, Code Organization, Event Logging

---

#### 8.5.3 ‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ó‡∏±‡πâ‡∏á 3 ‡∏Å‡∏•‡∏∏‡πà‡∏°

| Aspect | Basic Prompt | Context Engineering | SDD |
|--------|--------------|---------------------|-----|
| **Architecture** | Monolithic/All-in-one | Better structure | Clean Architecture ‚úÖ |
| **Error Handling** | Basic/Array | Structured codes | Error Factory ‚úÖ |
| **Code Organization** | Long functions | Better comments | Extracted Functions ‚úÖ |
| **Transaction** | Manual | Manual | Transaction Helper ‚úÖ |
| **Data Access** | Direct SQL | Better SQL | Repository Pattern ‚úÖ |
| **Logging** | console.log | console.log | Structured Logging ‚úÖ |
| **Validation** | Basic/Mixed | Better validation | Extracted Functions ‚úÖ |

---

### 8.6 ‡∏Ç‡πâ‡∏≠‡∏Ñ‡πâ‡∏ô‡∏û‡∏ö‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç

**1. SDD ‡πÉ‡∏´‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î**

**‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô:**
- **v.9 (SDD):** Repository + Service Pattern, Structured error codes, Structured logging
- **v.10 (SDD):** Service Layer + Extracted Functions
- **v.11 (SDD):** Clean Architecture, Error Factory, Event Logging

**‡∏™‡∏£‡∏∏‡∏õ:** SDD ‡πÉ‡∏´‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏≠‡∏≤‡∏î maintainable ‡πÅ‡∏•‡∏∞‡∏°‡∏µ architecture ‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î

**2. Context Engineering ‡∏ä‡πà‡∏ß‡∏¢‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á Error Handling**

**‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô:**
- **v.6:** Better error messages, Atomic transactions
- **v.7:** Structured error codes (`BAD_REQUEST`, `INSUFFICIENT_STOCK`)
- **v.8:** Structured error codes (`COUPON_EXPIRED`, `MIN_PURCHASE_NOT_MET`)

**‡∏™‡∏£‡∏∏‡∏õ:** Context Engineering ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ error handling ‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ Clean Architecture

**3. Basic Prompt ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ ‡πÅ‡∏ï‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î**

**‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô:**
- **v.3:** ‡∏°‡∏µ FOR UPDATE, Transaction ‡πÅ‡∏ï‡πà Low stock alert ‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å transaction
- **v.4:** ‡∏°‡∏µ Service Layer, Transaction Helper, Zod validation ‡πÅ‡∏ï‡πà Code Duplications ‡∏™‡∏π‡∏á (65.5%)
- **v.5:** ‡∏°‡∏µ coupon validation, order of operations ‡πÅ‡∏ï‡πà‡πÇ‡∏Ñ‡πâ‡∏î‡∏¢‡∏≤‡∏ß‡∏°‡∏≤‡∏Å (all-in-one)

**‡∏™‡∏£‡∏∏‡∏õ:** Basic Prompt ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ ‡πÅ‡∏ï‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÉ‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á Code Organization ‡πÅ‡∏•‡∏∞ Architecture

---

## üìä 9. ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à

### 8.1 ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÇ‡∏Ñ‡πâ‡∏î

- **Average Quality Score:** 3.60‚≠ê (v.3-v.11)
- **Quality Improvement:** 2 stars (v.3: 3‚≠ê ‚Üí v.11: 5‚≠ê)
- **Best Version:** v.11 (5‚≠ê) - SDD
- **Worst Version:** v.3 (3‚≠ê) - Basic Prompt (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô)

### 8.2 Features

- **Average Features:** 5.2 features per version (v.3-v.11)
- **Most Features:** v.11 (10 features) - SDD
- **Least Features:** v.3 (3 features) - Basic Prompt

### 8.3 SonarQube Metrics

- **Best Security:** v.2, v.3, v.4, v.5, v.6, v.7, v.8, v.11 (0)
- **Worst Security:** v.10 (5)
- **Best Reliability:** v.5 (1)
- **Worst Reliability:** v.9 (22)
- **Best Maintainability:** v.3 (7)
- **Worst Maintainability:** v.6 (26)
- **Best Duplications:** v.8, v.11 (0.0%)
- **Worst Duplications:** v.4 (65.5%)

---

## üéØ 10. ‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞

### 10.1 ‡∏™‡∏£‡∏∏‡∏õ

1. **‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÇ‡∏Ñ‡πâ‡∏î‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á** - ‡∏à‡∏≤‡∏Å v.3 (3‚≠ê) ‡πÑ‡∏õ‡∏ñ‡∏∂‡∏á v.11 (5‚≠ê)
2. **v.11 ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î** - ‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á 3 ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (SDD)
3. **v.4 ‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏∏‡∏î‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç** - ‡πÄ‡∏û‡∏¥‡πà‡∏° Zod, ES Modules, Row Locking (Basic Prompt)
4. **SDD ‡πÉ‡∏´‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î** - Average Quality 4.33‚≠ê, Best Version (v.11: 5‚≠ê)
5. **Context Engineering ‡∏•‡∏î Code Duplications ‡πÑ‡∏î‡πâ‡∏î‡∏µ** - v.8: 0.0% (‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)
6. **‡∏û‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:** Test Coverage = 0.0%, Code Duplications ‡∏™‡∏π‡∏á (v.4: 65.5%), Security vulnerabilities (v.10: 5 ‡∏à‡∏∏‡∏î)

### 10.2 ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞

#### ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö AI-Assisted Development

1. **‡πÉ‡∏ä‡πâ SDD ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡πÉ‡∏´‡∏°‡πà**
   - ‡πÉ‡∏´‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (Average Quality 4.33‚≠ê)
   - v.11 ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏µ (5‚≠ê, Clean Architecture)
   - ‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ specification ‡∏ó‡∏µ‡πà‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤

2. **‡πÉ‡∏ä‡πâ Context Engineering ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î Code Duplications**
   - v.8 ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤ Context Engineering ‡∏•‡∏î Duplications ‡πÑ‡∏î‡πâ‡∏î‡∏µ (0.0%)
   - ‡∏Ñ‡∏ß‡∏£‡πÉ‡∏´‡πâ context ‡∏ó‡∏µ‡πà‡∏î‡∏µ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö requirements ‡πÅ‡∏•‡∏∞ best practices

3. **Basic Prompt ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ß‡∏±‡∏á**
   - v.4 ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤ Basic Prompt ‡πÉ‡∏´‡πâ features ‡∏î‡∏µ ‡πÅ‡∏ï‡πà Code Duplications ‡∏™‡∏π‡∏á (65.5%)
   - ‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ code review ‡πÅ‡∏•‡∏∞ refactoring ‡∏´‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤

#### ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Developer

#### ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Developer

1. **‡πÉ‡∏ä‡πâ v.11 ‡πÄ‡∏õ‡πá‡∏ô reference** - Clean Architecture, Best Practices
2. **‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏à‡∏≤‡∏Å v.4** - ES Modules + Zod + Transactions
3. **‡∏®‡∏∂‡∏Å‡∏©‡∏≤ v.6** - Concurrency Safety
4. **‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÉ‡∏ô v.4, v.10** - Code Duplications ‡∏™‡∏π‡∏á

#### ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Project Manager

1. **‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Development Method ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£**
   - **SDD:** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á (v.11: 5‚≠ê)
   - **Context Engineering:** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏î Code Duplications (v.8: 0.0%)
   - **Basic Prompt:** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß ‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ code review

2. **‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤ Test Coverage 70-80%** - ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô 0.0%
3. **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Security vulnerabilities** - ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ v.10 (5 ‡∏à‡∏∏‡∏î)
4. **Refactor Code Duplications** - ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ v.4 (65.5%)
5. **‡πÉ‡∏ä‡πâ v.11 ‡πÄ‡∏õ‡πá‡∏ô baseline** - ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà

1. **‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤ Test Coverage 70-80%** - ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô 0.0%
2. **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Security vulnerabilities** - ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ v.10 (5 ‡∏à‡∏∏‡∏î)
3. **Refactor Code Duplications** - ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ v.4 (65.5%)
4. **‡πÉ‡∏ä‡πâ v.11 ‡πÄ‡∏õ‡πá‡∏ô baseline** - ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà

#### ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Technical Lead

1. **‡∏Å‡∏≥‡∏´‡∏ô‡∏î Coding Standards** - ‡πÉ‡∏ä‡πâ v.11 ‡πÄ‡∏õ‡πá‡∏ô reference
2. **Setup CI/CD with SonarQube** - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
3. **Code Review Process** - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Architecture, Patterns
4. **Training** - ‡∏™‡∏≠‡∏ô Clean Architecture, Best Practices

---

## üìö 11. ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á

### ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏Å

1. [Code Review Analysis](./CODE_REVIEW.md) - ‡∏Å‡∏≤‡∏£‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
2. [SonarQube Analysis](./versions/sonarQube.md) - ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
3. [Version Analysis Notebook](./version_analysis.ipynb) - ‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤

**‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** Code Evolution Analysis ‡∏ñ‡∏π‡∏Å‡∏£‡∏ß‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 8 ‡∏Ç‡∏≠‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß

### External Resources

- [SonarQube Documentation](https://docs.sonarqube.org/)
- [Clean Architecture by Robert C. Martin](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)
- [Zod Documentation](https://zod.dev/)
- [PostgreSQL Row Locking](https://www.postgresql.org/docs/current/explicit-locking.html)


---

## üìù 12. ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå

1. **Code Review:** ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏≤‡∏Å Architecture, Patterns, Features, Best Practices
2. **SonarQube:** ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å Security, Reliability, Maintainability, Duplications
3. **Version Analysis:** ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ (Trends, Evolution, Comparisons)

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤ (Development Methods)

1. **Basic Prompt (v.3-v.5):** ‡πÉ‡∏ä‡πâ prompt ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤
2. **Context Engineering (v.6-v.8):** ‡πÉ‡∏ä‡πâ context ‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤
3. **SDD - Spec-Driven Development (v.9-v.11):** ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡∏≤‡∏° specification ‡∏ó‡∏µ‡πà‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î

### ‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î

1. **Test Coverage:** ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Test Coverage (0.0%) - ‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏à‡∏£‡∏¥‡∏á
2. **Code Duplications:** v.4 ‡πÅ‡∏•‡∏∞ v.10 ‡∏°‡∏µ Duplications ‡∏™‡∏π‡∏á - ‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏£‡∏≤‡∏∞ copy-paste
3. **Security Hotspots:** ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á - SonarQube ‡πÅ‡∏Ñ‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏∏‡∏î

### ‡∏Å‡∏≤‡∏£‡∏ï‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏•

- **Code Review:** ‡πÄ‡∏ô‡πâ‡∏ô Architecture ‡πÅ‡∏•‡∏∞ Best Practices
- **SonarQube:** ‡πÄ‡∏ô‡πâ‡∏ô Metrics ‡πÅ‡∏•‡∏∞ Automated Analysis
- **Version Analysis:** ‡πÄ‡∏ô‡πâ‡∏ô Trends ‡πÅ‡∏•‡∏∞ Evolution

**‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:** ‡∏Ñ‡∏ß‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏ó‡∏±‡πâ‡∏á 3 ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô

---

*‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏°‡∏à‡∏≤‡∏Å 3 ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå*  
*‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á: 2026-01-24*  
*‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: 2026-01-24*
